# Perform A Vulnerability Scan With OpenVAS
OpenVAS is a vulnerability assessment tool designed to scan networks for potential security weaknesses. It can identify vulnerabilities in operating systems, applications, and databases, as well as assess the security of networks and systems.

## References
- [How to detect, enable and disable SMBv1, SMBv2, and SMBv3 in Windows](https://learn.microsoft.com/en-us/windows-server/storage/file-server/troubleshoot/detect-enable-and-disable-smbv1-v2-v3?tabs=server#for-windows-7-windows-server-2008-r2-windows-vista-and-windows-server-2008) by Microsoft
- [Apache Lounge](https://www.apachelounge.com/download/win64/) by Apache
- [Microsoft Visual C++ 2010 Service Pack 1 Redistributable Package MFC Security Update](https://www.microsoft.com/en-us/download/details.aspx?id=26999) by Microsoft


## Tasks
- Setup 1 attacker machine (Kali Linux) and 3 target machines (Windows 10, Lubuntu, Windows 7)
- Research common vulnerabilities that OpenVAS can identify
- Select a practical vulnerability and simulate it within Windows 7 (Chosen vulnerability: SMBv1)
- Initiate a vulnerability scan against Windows 10 VM and display scan reports generated by OpenVAS
- Initiate a vulnerability scan against Lubuntu VM and display scan reports generated by OpenVAS
- Initiate a vulnerability scan against Windows 7 VM and display scan reports generated by OpenVAS
  

## Solutions With Screenshots
Chosen Vulnerability: SMBv1 

#### Enabling SMBv1 via Registry (With PowerShell v2.0 or later)
- To detect SMBv1 on SMB server (Windows 7 VM):
  ```
  Get-Item HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters | ForEach-Object {Get-ItemProperty $_.pspath}
  ```
- Default configuration = Enabled (No registry named value is created), so no SMB1 value will be returned
- To enable SMBv1;
  ```
  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" SMB1 -Type DWORD -Value 1 -Force
  ```
- To disable SMBv1:
  ```
  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" SMB1 -Type DWORD -Value 0 -Force
  ```
- After changes are made, the computer/VM must be restarted


#### Enabling SMBv1 via Registry (Without PowerShell)
- Since PowerShell 1.0 can't handle the commands to check or enable SMBv1, it needs to be enabled manually via the registry or using the Control Panel
- Open Registry Editor (regedit.exe)
- Navigate to: `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters`
- To enable SMBv1 on the SMB server, configure it by creating a new DWORD (32-bit) value. Name it SMB1 and set its value to 1 (to enable SMBv1) as shown below:
  ```
  Registry entry: SMB1
  REG_DWORD: 0 = Disabled
  REG_DWORD: 1 = Enabled
  Default: 1 = Enabled (No registry key is created)
  ```
- After changes are made, restart the machine to apply the changes

Chosen vulnerability: Apache 2.2.34 64-bit
#### Enabling Apache 2.2.34
- Download Microsoft Visual C++ 2010 Redistributable in the reference link above. Select 'vcredist_x64.exe' for 64-bit Windows, download and install
- Download Apache 2.2.34 64-bit from the reference link above and extract the files to the location `C:\Apache2`. To install Apache, open a Command Prompt with administrator privileges, and navigate to the Apache bin directory using `cd C:\Apache2\bin`
- Now install Apache as a service with the command `httpd -k install`
- After successful installation, run the Apache with `httpd -k start`
- To verify Apache is running, open the web browser and visit `http://localhost`. A text in the web browser stating "It Works!" should appear
![image](https://github.com/user-attachments/assets/ab0daae0-e765-4e6e-807d-84c7b9ce6472)


#### Enable OpenVAS on Docker in Kali Linux
- List all the running containers: `docker ps -a`
- Run `sudo gvm-check-setup`. Once you see a `It seems like your OpenVAS-9 installation is OK.`, If 
- If the error notification for `ERROR: gsad service did not start` appears, run `sudo systemctl status gsad` and `sudo systemctl restart gsad` to check and restart the Greenbone Security Assistant Daemon (GSAD)
- To update OpenVAS database that contains CVEs and etc., use `sudo greenbone-feed-sync`
- To start OpenVAS, run the command `docker run -d -p 443:443 -p 9392:9392 --name openvas mikesplain/openvas` and enter the following URL in the web browser: `https://127.0.0.1:9392/login`. The login username and password are both set to `admin`


#### Screenshot of vulnerability scanning task for all 3 VMs:
- Windows 7 VM IP address: 192.168.1.7
- Windows 10 VM IP address: 192.168.1.10
- Lubuntu VM IP address: 192.168.1.17

![image](https://github.com/user-attachments/assets/51b65300-7281-44e5-9487-ecf19959ab59)

<br/>

Detected Apache vulnerabilities by OpenVAS:
![image](https://github.com/user-attachments/assets/4482a3b6-88e2-40e9-b489-609bf920d59c)

  
